-----------------------------------------------------------
-- ç™½ç¾½è„šæœ¬éªŒè¯æ ¸å¿ƒé€»è¾‘ï¼ˆLocalScriptï¼Œé€‚é…å¤šæ³¨å…¥å™¨ï¼‰
-- éªŒè¯æ ‡è®°ï¼šæ³¨å…¥å™¨æŒä¹…åŒ–ç›®å½•ä¸‹çš„"åŒæ„ç™½ç¾½è„šæœ¬"æ–‡ä»¶å¤¹
-----------------------------------------------------------

-- ================ åŸºç¡€æœåŠ¡ä¸å˜é‡ ================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local Color3 = Color3
local UDim2 = UDim2
local Instance = Instance
local task = task
local Enum = Enum

-- æ³¨å…¥å™¨æ–‡ä»¶æ“ä½œå…¼å®¹ï¼ˆæ ¸å¿ƒï¼šè·å–æŒä¹…åŒ–è·¯å¾„ï¼‰
local readFunc, writeFunc, getPathFunc
pcall(function()
    -- é€‚é…å¿è€…/Delta/Synapseç­‰æ³¨å…¥å™¨
    if type(syn) == "table" then
        readFunc = syn.readfile or readfile
        writeFunc = syn.writefile or writefile
        getPathFunc = syn.datapath -- å¿è€…æ³¨å…¥å™¨è·å–æ²™ç›’è·¯å¾„
    else
        -- å…¶ä»–æ³¨å…¥å™¨å…¼å®¹
        readFunc = readfile or readFile
        writeFunc = writefile or writeFile
        -- å°è¯•è·å–é»˜è®¤è·¯å¾„ï¼ˆå¦‚Krnlç­‰ï¼‰
        getPathFunc = function()
            return "Roblox/Scripts"
        end
    end
end)

-- ================ éªŒè¯æ–‡ä»¶å¤¹æ ¸å¿ƒé€»è¾‘ ================
-- è·å–æŒä¹…åŒ–æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆè·¨æ³¨å…¥å™¨å…¼å®¹ï¼‰
local function getVerifyFolderPath()
    local basePath
    if getPathFunc then
        -- ä¼˜å…ˆä½¿ç”¨æ³¨å…¥å™¨æä¾›çš„æ²™ç›’è·¯å¾„ï¼ˆå¦‚å¿è€…çš„syn.datapath()ï¼‰
        basePath = getPathFunc()
    else
        -- fallbackè·¯å¾„ï¼ˆé€‚é…å¤šæ•°PCæ³¨å…¥å™¨ï¼‰
        basePath = "C:/RobloxScripts" -- å¯æ ¹æ®ç³»ç»Ÿè‡ªåŠ¨è°ƒæ•´
        pcall(function()
            -- å°è¯•æ£€æµ‹ç³»ç»Ÿç±»å‹ï¼ˆWindows/macOSï¼‰
            if game:GetService("RunService"):IsStudio() then
                basePath = "Roblox/Scripts" -- Studioç¯å¢ƒ
            elseif string.find(game:GetService("MarketplaceService"):GetProductInfo(1).Name, "Mac") then
                basePath = "~/Library/Roblox/Scripts" -- macOSè·¯å¾„
            end
        end)
    end
    -- æ‹¼æ¥å®Œæ•´æ–‡ä»¶å¤¹è·¯å¾„
    return basePath .. "/åŒæ„ç™½ç¾½è„šæœ¬"
end

-- æ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼ˆè·¨æ³¨å…¥å™¨å…¼å®¹ï¼‰
local function folderExists()
    if not readFunc then
        return false
    end -- æ— æ–‡ä»¶æ“ä½œèƒ½åŠ›åˆ™å¼ºåˆ¶éªŒè¯
    local folderPath = getVerifyFolderPath()
    -- å°è¯•è¯»å–æ–‡ä»¶å¤¹ï¼ˆæ³¨å…¥å™¨é€šå¸¸é€šè¿‡æ£€æŸ¥è·¯å¾„æ˜¯å¦å¯è®¿é—®åˆ¤æ–­å­˜åœ¨æ€§ï¼‰
    local success = pcall(function()
        -- ä¸åŒæ³¨å…¥å™¨åˆ¤æ–­æ–¹å¼å¯èƒ½ä¸åŒï¼Œè¿™é‡Œç”¨"å°è¯•è¯»å–"ä½œä¸ºå­˜åœ¨æ€§æ£€æµ‹
        readFunc(folderPath .. "/.verify") -- è¯»å–æ–‡ä»¶å¤¹å†…çš„æ ‡è®°æ–‡ä»¶
    end)
    return success
end

-- åˆ›å»ºéªŒè¯æ–‡ä»¶å¤¹ï¼ˆè·¨æ³¨å…¥å™¨å…¼å®¹ï¼‰
local function createTargetFolder()
    if not writeFunc then
        return
    end -- æ— å†™å…¥èƒ½åŠ›åˆ™è·³è¿‡ï¼ˆä¸å½±å“ä½¿ç”¨ï¼Œä»…ä¸‹æ¬¡ä»éœ€éªŒè¯ï¼‰
    local folderPath = getVerifyFolderPath()
    local success = pcall(function()
        -- 1. åˆ›å»ºæ–‡ä»¶å¤¹ï¼ˆæ³¨å…¥å™¨é€šå¸¸æ”¯æŒé€šè¿‡å†™å…¥ç©ºæ–‡ä»¶åˆ›å»ºæ–‡ä»¶å¤¹ï¼‰
        writeFunc(folderPath .. "/.verify", "") -- å†™å…¥ç©ºæ ‡è®°æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºçˆ¶æ–‡ä»¶å¤¹
        print("éªŒè¯æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸï¼š" .. folderPath)
    end)
    if not success then
        -- é™çº§æ–¹æ¡ˆï¼šè‹¥æ— æ³•åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œä¸´æ—¶ç”¨PlayerGuiæ–‡ä»¶å¤¹ï¼ˆä»…å½“å‰ä¼šè¯æœ‰æ•ˆï¼‰
        local tempFolder = Instance.new("Folder")
        tempFolder.Name = "åŒæ„ç™½ç¾½è„šæœ¬"
        tempFolder.Parent = PlayerGui
        print("è­¦å‘Šï¼šæŒä¹…åŒ–æ–‡ä»¶å¤¹åˆ›å»ºå¤±è´¥ï¼Œä½¿ç”¨ä¸´æ—¶æ–‡ä»¶å¤¹ï¼ˆä»…å½“å‰ä¼šè¯æœ‰æ•ˆï¼‰")
    end
end

-- ================ é€šç”¨UIå·¥å…·å‡½æ•° ================
-- åˆ›å»ºå±å¹•GUI
local function createScreenGui(name)
    local gui = Instance.new("ScreenGui")
    gui.Name = name
    gui.IgnoreGuiInset = true
    gui.Parent = PlayerGui
    return gui
end

-- åˆ›å»ºå¸¦åœ†è§’çš„æ¡†æ¶
local function createFrame(parent, size, position)
    local frame = Instance.new("Frame")
    frame.Size = size
    frame.Position = position
    frame.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    frame.BackgroundTransparency = 0.3
    frame.BorderSizePixel = 1
    frame.BorderColor3 = Color3.fromRGB(220, 240, 255)
    frame.Parent = parent
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = frame
    return frame
end

-- åˆ›å»ºåŸºç¡€æ ‡ç­¾
local function createBasicLabel(parent, text, size, position)
    local label = Instance.new("TextLabel")
    label.Text = text
    label.Size = size
    label.Position = position
    label.TextColor3 = Color3.new(1, 1, 1)
    label.TextSize = 16
    label.BackgroundTransparency = 1
    label.Parent = parent
    return label
end

-- åˆ›å»ºæ™®é€šæ ‡ç­¾
local function createLabel(parent, text, size, position)
    local label = Instance.new("TextLabel")
    label.Text = text
    label.Size = size
    label.Position = position
    label.TextColor3 = Color3.new(1, 1, 1)
    label.TextSize = 16
    label.BackgroundTransparency = 1
    label.Parent = parent
    return label
end

-- åˆ›å»ºæŒ‰é’®
local function createButton(parent, text, size, position, callback)
    local btn = Instance.new("TextButton")
    btn.Text = text
    btn.Size = size
    btn.Position = position
    btn.BackgroundColor3 = Color3.fromRGB(80, 80, 120)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.TextSize = 14
    btn.Parent = parent
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = btn
    if callback then
        btn.MouseButton1Click:Connect(callback)
    end
    return btn
end

-- åˆ›å»ºç‚¹å‡»è¾“å…¥æ¡†
local function createClickToInput(parent, size, position, triggerText, placeholderText)
    local trigger = Instance.new("TextButton")
    trigger.Size = size
    trigger.Position = position
    trigger.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
    trigger.BackgroundTransparency = 0.7
    trigger.Text = triggerText
    trigger.TextColor3 = Color3.new(1, 1, 1)
    trigger.TextSize = 14
    trigger.Parent = parent
    local cornerTrigger = Instance.new("UICorner")
    cornerTrigger.CornerRadius = UDim.new(0, 6)
    cornerTrigger.Parent = trigger
    local box = Instance.new("TextBox")
    box.Size = size
    box.Position = position
    box.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
    box.BackgroundTransparency = 0.7
    box.TextColor3 = Color3.new(1, 1, 1)
    box.TextSize = 14
    box.PlaceholderText = placeholderText
    box.Visible = false
    box.Parent = parent
    local cornerBox = Instance.new("UICorner")
    cornerBox.CornerRadius = UDim.new(0, 6)
    cornerBox.Parent = box
    trigger.MouseButton1Click:Connect(function()
        trigger.Visible = false
        box.Visible = true
        box:CaptureFocus()
    end)
    return trigger, box
end

-- æ’­æ”¾ä¸´æ—¶éŸ³æ•ˆ
local function playTempSound(soundId)
    local fullSoundId = "rbxassetid://" .. tostring(soundId)
    local sound = Instance.new("Sound")
    sound.SoundId = fullSoundId
    sound.Volume = 1.0
    sound.Parent = workspace
    pcall(function()
        sound:Play()
        sound.Ended:Connect(function()
            sound:Destroy()
        end)
        task.delay(5, function()
            if sound.Parent then
                sound:Destroy()
            end
        end)
    end)
end

-- ================ éªŒè¯å¼¹çª—é€»è¾‘ ================
-- ç›¸å…³éªŒè¯ï¼ˆè¿™é‡Œå‡è®¾éœ€è¦ç±»ä¼¼çš„éªŒè¯é€»è¾‘ï¼Œæ–‡æœ¬æ”¹ä¸ºç™½ç¾½ç›¸å…³ï¼‰
local function Popup_VerifyRelated()
    local gui = createScreenGui("Popup_Related")
    local frame = createFrame(gui, UDim2.new(0, 420, 0, 240), UDim2.new(0.5, -210, 0.5, -120))
    createLabel(frame, "ç™½ç¾½ç›¸å…³éªŒè¯é—®é¢˜ï¼Ÿ", UDim2.new(1, 0, 0, 35), UDim2.new(0, 0, 0, 25))
    local _, inputRelated = createClickToInput(
        frame, UDim2.new(1, -50, 0, 45), UDim2.new(0, 25, 0, 75),
        "ç‚¹å‡»è¾“å…¥ç­”æ¡ˆ", "è¯·è¾“å…¥æ­£ç¡®ç­”æ¡ˆ"
    )
    local statusLabel = createLabel(frame, "", UDim2.new(1, 0, 0, 25), UDim2.new(0, 0, 0, 135))
    local done = false
    createButton(frame, "éªŒè¯ç­”æ¡ˆ", UDim2.new(0.45, 0, 0, 35), UDim2.new(0.1, 0, 0, 175), function()
        if inputRelated.Text == "ç™½ç¾½ä¸“å±ç­”æ¡ˆ" then
            done = true
            gui:Destroy()
        else
            statusLabel.Text = "ç­”æ¡ˆé”™è¯¯ï¼Œæ— æ³•ä½¿ç”¨ç™½ç¾½è„šæœ¬å“¦ğŸ˜¡"
            statusLabel.TextColor3 = Color3.fromRGB(255, 60, 60)
        end
    end)
    createButton(frame, "é€€å‡ºè„šæœ¬", UDim2.new(0.45, 0, 0, 35), UDim2.new(0.5, 0, 0, 175), function()
        gui:Destroy()
        error("ç”¨æˆ·ä¸»åŠ¨é€€å‡ºï¼Œè„šæœ¬åœæ­¢è¿è¡Œ")
    end)
    while not done do
        task.wait()
    end
end

-- å…¶ä»–éªŒè¯ï¼ˆåŒç†ä¿®æ”¹æ–‡æœ¬ï¼‰
local function Popup_OtherVerify()
    local gui = createScreenGui("Popup_OtherVerify")
    local frame = createFrame(gui, UDim2.new(0, 420, 0, 260), UDim2.new(0.5, -210, 0.5, -130))
    createLabel(frame, "å…³äºç™½ç¾½çš„å¦ä¸€ä¸ªé—®é¢˜ï¼Ÿ", UDim2.new(1, 0, 0, 35), UDim2.new(0, 0, 0, 25))
    local _, inputOther = createClickToInput(
        frame, UDim2.new(1, -50, 0, 45), UDim2.new(0, 25, 0, 75),
        "ç‚¹å‡»è¾“å…¥ç­”æ¡ˆ", "è¯·è¾“å…¥æœ‰æˆ–è€…æ²¡æœ‰ç­‰ç­”æ¡ˆ"
    )
    local statusLabel = createLabel(frame, "", UDim2.new(1, 0, 0, 25), UDim2.new(0, 0, 0, 135))
    local exitCount = 0
    local done = false
    createButton(frame, "ç¡®å®šå›ç­”", UDim2.new(0.45, 0, 0, 35), UDim2.new(0.1, 0, 0, 185), function()
        statusLabel.Text = "å›ç­”é”™è¯¯å‘€"
        statusLabel.TextColor3 = Color3.fromRGB(255, 60, 60)
    end)
    createButton(frame, "é€€å‡ºå›ç­”", UDim2.new(0.45, 0, 0, 35), UDim2.new(0.5, 0, 0, 185), function()
        exitCount += 1
        if exitCount == 1 then
            statusLabel.Text = "ç¡®å®šè¦é€€å‡ºå›ç­”å—ï¼Ÿ"
            statusLabel.TextColor3 = Color3.fromRGB(255, 220, 60)
        elseif exitCount >= 2 then
            done = true
            gui:Destroy()
        end
    end)
    while not done do
        task.wait()
    end
    -- æœ€ç»ˆæç¤º
    local notifyGui = createScreenGui("Popup_FinalNotice")
    local notifyFrame = createFrame(notifyGui, UDim2.new(0, 340, 0, 120), UDim2.new(0.5, -170, 0.5, -60))
    createLabel(notifyFrame, "éªŒè¯é€šè¿‡ï¼Œç™½ç¾½è„šæœ¬å¯ä½¿ç”¨ğŸ¤“", UDim2.new(1, 0, 0, 35), UDim2.new(0, 0, 0, 45))
    playTempSound("12222253")
    task.wait(3)
    notifyGui:Destroy()
end

-- ================ å…¬å‘Šå¼¹çª—ï¼ˆå…¬å‘Šæ–‡å­—å¯æ ¹æ®ç™½ç¾½ä¸»é¢˜ä¿®æ”¹ï¼‰ ================
local function showAnnouncement()
    local noticeGui = createScreenGui("Popup_Announcement")
    local noticeFrame = createFrame(noticeGui, UDim2.new(0, 400, 0, 250), UDim2.new(0.5, -200, 0.5, -125))
    -- æ ‡é¢˜
    local titleLabel = createBasicLabel(noticeFrame, "ç™½ç¾½è„šæœ¬ ç‰ˆæœ¬å…¬å‘Š", UDim2.new(1, 0, 0, 40), UDim2.new(0, 0, 0, 15))
    titleLabel.TextColor3 = Color3.fromRGB(255, 210, 0)
    titleLabel.TextXAlignment = Enum.TextXAlignment.Center
    -- å†…å®¹ï¼ˆå¯æ ¹æ®ç™½ç¾½ä¸»é¢˜ä¿®æ”¹æ›´æ–°æ—¥å¿—ç­‰å†…å®¹ï¼‰
    local contentLabel = createLabel(noticeFrame, "ç™½ç¾½è„šæœ¬æ›´æ–°æ—¥å¿—ï¼š\næ–°å¢ç™½ç¾½ä¸“å±åŠŸèƒ½æ¨¡å—\nä¼˜åŒ–è„šæœ¬è¿è¡Œç¨³å®šæ€§\nä¿®å¤éƒ¨åˆ†å·²çŸ¥é—®é¢˜", UDim2.new(1, -40, 0, 140), UDim2.new(0, 20, 0, 60))
    contentLabel.TextWrapped = true
    contentLabel.TextXAlignment = Enum.TextXAlignment.Left
    -- å…³é—­æŒ‰é’®
    local noticeDone = false
    createButton(noticeFrame, "æˆ‘çŸ¥é“äº†", UDim2.new(0.5, 0, 0, 40), UDim2.new(0.25, 0, 1, -50), function()
        noticeDone = true
        noticeGui:Destroy()
    end)
    while not noticeDone do
        task.wait()
    end
end

-- ================ å³ä¸‹è§’å¼¹çª—é€»è¾‘ ======================
local NOTIFICATION_DATA = {
    maxCount = 5, -- æœ€å¤§å åŠ æ•°é‡
    spacing = 6, -- çª—å£é—´è·
    width = 120, -- çª—å£å®½åº¦
    height = 60, -- çª—å£é«˜åº¦
    activeWindows = {} -- å­˜å‚¨å½“å‰æ´»è·ƒçª—å£ï¼ˆæŒ‰åºå·æ’åºï¼‰
}

local function updateWindowPositions()
    -- éå†æ‰€æœ‰æ´»è·ƒçª—å£ï¼ŒæŒ‰åºå·é‡æ–°è®¡ç®—ä½ç½®ï¼ˆåºå·1åœ¨æœ€é¡¶éƒ¨ï¼‰
    for index, windowData in ipairs(NOTIFICATION_DATA.activeWindows) do
        local frame = windowData.frame
        if frame and frame:IsDescendantOf(game) then
            -- è®¡ç®—ç»å¯¹Yåæ ‡ï¼šåºå·è¶Šå¤§è¶Šé ä¸‹ï¼ŒXè½´ç´§è´´å³ä¾§ï¼ˆä»…ç•™2åƒç´ ç¼éš™ï¼‰
            local targetY = -NOTIFICATION_DATA.height - 10 - (NOTIFICATION_DATA.height + NOTIFICATION_DATA.spacing) * (index - 1)
            frame.Position = UDim2.new(
                1, -NOTIFICATION_DATA.width - 2, -- å³ä¾§ä»…ç•™2åƒç´ ç¼éš™
                1, targetY -- åŸºäºåºå·çš„Yåæ ‡ï¼ˆåºå·1æœ€é ä¸Šï¼‰
            )
        end
    end
end

local function showNotification(title, text, duration)
    local localPlayer = Players.LocalPlayer
    if not localPlayer then
        return
    end
    local playerGui = localPlayer:FindFirstChild("PlayerGui")
    if not playerGui then
        return
    end

    -- æ­¥éª¤1ï¼šç§»é™¤è¶…å‡ºä¸Šé™çš„æœ€æ—§çª—å£ï¼ˆæœ€åä¸€ä¸ªï¼‰
    if #NOTIFICATION_DATA.activeWindows >= NOTIFICATION_DATA.maxCount then
        local oldestWindow = NOTIFICATION_DATA.activeWindows[#NOTIFICATION_DATA.activeWindows]
        if oldestWindow and oldestWindow.gui:IsDescendantOf(game) then
            oldestWindow.gui:Destroy()
        end
        table.remove(NOTIFICATION_DATA.activeWindows, #NOTIFICATION_DATA.activeWindows)
    end

    -- æ­¥éª¤2ï¼šæ‰€æœ‰ç°æœ‰çª—å£åºå·+1ï¼ˆç´¢å¼•åç§»ï¼‰
    for i = #NOTIFICATION_DATA.activeWindows, 1, -1 do
        NOTIFICATION_DATA.activeWindows[i].index = i + 1
    end

    -- æ­¥éª¤
